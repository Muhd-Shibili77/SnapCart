<%- include ("../partial/header" )-%>


<div class="login_align">


<div class="login-container">
   
    <div class="login-form mt-5">
        <h2 class="text-center">Enter your Email</h2>
        
        <form class="mt-3" id="forgetPasswordform">
            <div class="input-group">
                <input type="email" id="email" name="email" class="form-email" placeholder="Email"  required>
            </div>
            <p class="text-danger" style="margin-left: 19vh; font-size: medium;"> <%= locals.emailExist ? emailExist : null  %></p>
           
            <div class="submit d-flex jusfity-content-end">
               
                    <button type="button" onclick="EnterEmail()" id="submitBtn" class="btn btn-dark px-4 py-2 mt-2" style="font-size: 0.9rem; margin-left: 94vh;">Submit</button>  
            </div>
           
           
        </form>
    </div>
</div>
</div>





<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    async function EnterEmail(){
    
     const email = document.getElementById('email').value.trim();
     const submit = document.getElementById('submitBtn')
     
     if(!email){
        Swal.fire({
            icon:'error',
            title:'email is empty',
            text:'email field not be empty',
            confirmButtonText:'OK'
        })
        return;
     }

     submit.disable = true
     submit.innerText='submiting....'

        try{
            const response = await fetch('/user/forgetPassword',{
                method:'POST',
                headers:{
                    'Content-Type':'application/json',
                },
                body:JSON.stringify({email})
            })

            const result = await response.json()

            if(response.ok){
                Swal.fire({
                    icon: 'success',
                    title: 'OTP sended',
                    text: result.message,
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.href = '/user/forgetOtp'; 
                });
            }else{
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: result.error, 
                    confirmButtonText: 'OK'
                });
            }
        }catch(error){
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An unexpected error occurred. Please try again later.',
                confirmButtonText: 'OK'
            });
        }



    }
</script>

<%- include ("../partial/footer" )-%>

